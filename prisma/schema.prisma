// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Livro {
  id          Int      @id @default(autoincrement())
  titulo      String
  autor       String
  isbn        String   @unique
  editora     String
  anoPublicacao Int
  categoria   String
  status      StatusLivro @default(DISPONIVEL)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  emprestimos Emprestimo[]

  @@map("livros")
}

model Usuario {
  id        Int      @id @default(autoincrement())
  nome      String
  email     String   @unique
  telefone  String?
  endereco  String?
  tipo      TipoUsuario @default(COMUM)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  emprestimos Emprestimo[]

  @@map("usuarios")
}

model Emprestimo {
  id          Int      @id @default(autoincrement())
  livroId     Int
  usuarioId   Int
  dataEmprestimo DateTime @default(now())
  dataDevolucaoPrevista DateTime
  dataDevolucaoReal DateTime?
  status      StatusEmprestimo @default(ATIVO)
  multa       Float? @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  livro   Livro   @relation(fields: [livroId], references: [id], onDelete: Cascade)
  usuario Usuario @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@map("emprestimos")
}

enum StatusLivro {
  DISPONIVEL
  EMPRESTADO
  RESERVADO
  MANUTENCAO
}

enum TipoUsuario {
  COMUM
  FUNCIONARIO
  ADMIN
}

enum StatusEmprestimo {
  ATIVO
  DEVOLVIDO
  ATRASADO
  CANCELADO
}